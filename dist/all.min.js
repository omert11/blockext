(()=>{"use strict";var t;!function(t){t.each="each",t.block="block",t.helper="helper"}(t||(t={}));const e=(()=>{let t=0;return()=>(t++,t-1)})();function r(t){const r=r=>{const s={id:e(),name:t.name,type:t.type,el:r.el,context:r.context,BX:r.BX,tag_context:{},add_context(t,e){s.tag_context[t]=e},get_context:t=>s.tag_context[t],del_context(t){delete s.tag_context[t]},get_html_attribute:t=>t.getAttribute(`bx-${s.name}`),get_data:(t,e)=>(t.split(".").forEach((t=>e="this"==t?e:e[t])),e),remove_tag_attribute:()=>s.el.removeAttribute(`bx-${s.name}`),use:()=>({break_loop:!1,context:s.context,...t.use.call(s)||{}}),get attr(){return s.get_html_attribute(s.el)},get data(){return s.get_data(s.attr,s.context)}};return s};return r._name=t.name,r._type=t.type,r}const s=[],a={get registry(){return[...s]},add(t){s.push(t)},get_tag_methods:t=>a.registry.filter((e=>t.includes(e._name)))},o=r({name:"for",type:t.each,use(){let t=this.data;t?Array.isArray(t)||(t=[t]):t=[],this.remove_tag_attribute(),this.el.setAttribute("bx-each-id",this.id.toString());const e=this.el.outerHTML;return{break_loop:!1,context:null,each_method(r,s,a,o){for(let s=0;s<t.length;s++){let n={...t[s],"bx-for-counter":s+1,"bx-for-counter0":s,"bx-for-first":0==s,"bx-for-last":s==t.length-1},h=(l=e,i=void 0,(i=document.createElement("div")).innerHTML=l.trim(),i.firstChild);r.before(h),a.call(o,s,h,n)}var l,i;r.remove()}}}});a.add(o);const l=r({name:"as-template",type:t.block,use(){return this.BX.templates[this.attr]=this.el.innerHTML,this.el.remove(),{break_loop:!0}}});a.add(l);const i=r({name:"get-template",type:t.block,use(){this.el.innerHTML=this.BX.templates[this.attr]}});a.add(i);const n=r({name:"context",type:t.block,use(){return{context:this.data}}});a.add(n);const h=r({name:"break",type:t.block,use:()=>({break_loop:!0})});a.add(h);const c=r({name:"break-is",type:t.block,use(){let t={break_loop:!1};try{t.break_loop=!this.data}catch(e){t.break_loop=!0}return this.add_context("base_attr",this.attr),this.remove_tag_attribute(),t}});a.add(c);const _=r({name:"show-is",type:t.block,use(){this.data&&this.el.style.removeProperty("display")}});a.add(_);const g=r({name:"get-text",type:t.helper,use(){this.el.innerHTML=this.data}});a.add(g);const u=r({name:"get-value",type:t.helper,use(){this.el.value=this.data}});a.add(u);const d=r({name:"set-attr",type:t.helper,use(){let t=this.attr.split(">"),e=2==t.length?"$$":t[2];e=t[0].split(",").map((t=>this.get_data(t,this.context))).reduce(((t,e)=>t.replace("$$",e)),e),this.el.setAttribute(t[1],e)}});function p(t,e,r,s){const a=t.children.length;for(let o=0;o<a;o++)t.children?.[o]&&r.call(s,o,t.children[o],e)}a.add(d);class b{constructor(t){let e=null;if("string"==typeof t){if(e=document.querySelector(t),!e)throw Error(`No element found in the dom with selector '${t}'.`)}else e=t;this.el=e,this.main_elements=this.el.querySelectorAll("[bx-main]"),this.raw_html=this.el.innerHTML,this.tag_instances=[],this.templates={},this.collect_tags(this.el)}collect_tags(t,e=/bx-(.*?)="(.*?)"/g){let r=Array.from(t.outerHTML.matchAll(e)),s=[];r.forEach((t=>{s.includes(t[1])||s.push(t[1])})),this.used_tags=s,this.tags=a.get_tag_methods(this.used_tags)}get_filtered_TAGS(t){return this[`__${t}_tag_cache`]||(this[`__${t}_tag_cache`]=this.tags.filter((e=>e._type==t))),this[`__${t}_tag_cache`]}*get_TAG_iter(t,e,r){for(const s of r)if(t.getAttribute(`bx-${s._name}`)){const r=s({el:t,context:e,BX:this});this.tag_instances.push(r),yield r}}get each_tags(){return this.get_filtered_TAGS(t.each)}get block_tags(){return this.get_filtered_TAGS(t.block)}get helper_tags(){return this.get_filtered_TAGS(t.helper)}get_each_tags(t,e){return this.get_TAG_iter(t,e,this.each_tags)}get_block_tags(t,e){return this.get_TAG_iter(t,e,this.block_tags)}get_helper_tags(t,e){return this.get_TAG_iter(t,e,this.helper_tags)}main_loop(t){this.main_elements.forEach((e=>this.top_loop(e,t,p)))}top_loop(t,e,r){let s=this.do_helpers(t,e);if(!s.break_loop)return r(t,e=s.context,this.loop,this),t}loop(t,e,r){let s=this.do_blocks(e,r);if(!s.break_loop){let t=s.context,r=this.do_each(e,t);this.top_loop(e,t,r.each_method||p)}return e}do_each(t,e){let r=this.get_each_tags(t,e).next().value;return r?r.use():{break_loop:!1,context:e}}do_blocks(t,e){let r=!1,s=this.get_block_tags(t,e);for(const t of s){let s=t.use();if(s.break_loop){r=!0;break}e=s.context}return{break_loop:r,context:e}}do_helpers(t,e){let r=!1,s=this.get_helper_tags(t,e);for(const t of s){let s=t.use();if(s.break_loop){r=!0;break}e=s.context}return{break_loop:r,context:e}}render(t){this.main_loop(t)}clean(){this.el.innerHTML=this.raw_html,this.main_elements=this.el.querySelectorAll("[bx-main]"),this.tag_instances=[]}}b.registry=a,b.tagFactory=r,globalThis.BlockeXt=b})();