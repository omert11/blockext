(()=>{"use strict";var t;!function(t){t.each="each",t.block="block",t.helper="helper"}(t||(t={}));const e=(()=>{let t=0;return()=>(t++,t-1)})();function a(t){const a=a=>{const r={id:e(),name:t.name,type:t.type,el:a.el,context:a.context,BX:a.BX,tag_context:{},add_context(t,e){r.tag_context[t]=e},get_context:t=>r.tag_context[t],del_context(t){delete r.tag_context[t]},get_html_attribute:t=>t.getAttribute(`bx-${r.name}`),get_data:(t,e)=>(t.split(".").forEach((t=>e="this"==t?e:e[t])),e),remove_tag_attribute:()=>r.el.removeAttribute(`bx-${r.name}`),use:()=>({break_loop:!1,context:r.context,...t.use.call(r)||{}}),clean(){if(t.clean)return t.clean.call(r)},get attr(){return r.get_html_attribute(r.el)},get data(){return r.get_data(r.attr,r.context)}};return r};return a._name=t.name,a._type=t.type,a}function r(t){var e=document.createElement("div");return e.innerHTML=t.trim(),e.firstChild}const s=[],o={get registry(){return[...s]},add(t){s.push(t)},get_tag_methods:t=>o.registry.filter((e=>t.includes(e._name)))},l=a({name:"for",type:t.each,use(){this.add_context("base_attr",this.attr);let t=this.data;t?Array.isArray(t)||(t=[t]):t=[],this.remove_tag_attribute(),this.el.setAttribute("bx-each-id",this.id.toString());const e=this.el.outerHTML;return this.add_context("loop_html",e),{break_loop:!1,context:null,each_method(a,s,o,l){for(let s=0;s<t.length;s++){let n={...t[s],"bx-for-counter":s+1,"bx-for-counter0":s,"bx-for-first":0==s,"bx-for-last":s==t.length-1},i=r(e);a.before(i),o.call(l,s,i,n)}a.remove()}}},clean(){const t=document.querySelectorAll(`[bx-each-id='${this.id}']`);let e=r(this.get_context("loop_html"));t.length&&(t[0].after(e),e.removeAttribute("bx-each-id"),e.setAttribute("bx-for",this.get_context("base_attr"))),t.forEach((t=>t.remove()))}});o.add(l);const n=a({name:"as-template",type:t.block,use(){return this.BX.templates[this.attr]=this.el.innerHTML,this.el.remove(),{break_loop:!0}}});o.add(n);const i=a({name:"get-template",type:t.block,use(){this.el.innerHTML=this.BX.templates[this.attr]},clean(){this.el.innerHTML=""}});o.add(i);const c=a({name:"context",type:t.block,use(){return{context:this.data}}});o.add(c);const h=a({name:"break",type:t.block,use:()=>({break_loop:!0})});o.add(h);const _=a({name:"break-is",type:t.block,use(){let t={break_loop:!1};try{t.break_loop=!this.data}catch(e){t.break_loop=!0}return this.add_context("base_attr",this.attr),this.remove_tag_attribute(),t},clean(){this.el.setAttribute("bx-break-is",this.get_context("base_attr"))}});o.add(_);const g=a({name:"show-is",type:t.block,use(){this.data&&this.el.style.removeProperty("display")},clean(){this.el.style.display="none"}});o.add(g);const u=a({name:"get-text",type:t.helper,use(){this.el.innerHTML=this.data},clean(){this.el.innerHTML=""}});o.add(u);const d=a({name:"get-value",type:t.helper,use(){this.el.value=this.data},clean(){this.el.value=""}});o.add(d);const b=a({name:"set-attr",type:t.helper,use(){let t=/(.*?)>\[(.*?)\]/g.exec(this.attr),e=this.get_data(t[1],this.context);this.add_context("target_attr",t[2]),this.el.setAttribute(this.get_context("target_attr"),e)},clean(){this.el.removeAttribute(this.get_context("target_attr"))}});function p(t,e,a,r){const s=t.children.length;for(let o=0;o<s;o++){const s=t.children[o];a.call(r,o,s,e)}}o.add(b);globalThis.BlockeXt=class{constructor(t){let e=null;if("string"==typeof t){if(e=document.querySelector(t),!e)throw Error(`No element found in the dom with selector '${t}'.`)}else e=t;this.el=e,this.main_elements=this.el.querySelectorAll("[bx-main]"),this.tag_instances=[],this.templates={},this.collect_tags(this.el)}collect_tags(t,e=/bx-(.*?)="(.*?)"/g){let a=Array.from(t.outerHTML.matchAll(e)),r=[];a.forEach((t=>{r.includes(t[1])||r.push(t[1])})),this.used_tags=r,this.tags=o.get_tag_methods(this.used_tags)}get_filtered_TAGS(t){return this[`__${t}_tag_cache`]||(this[`__${t}_tag_cache`]=this.tags.filter((e=>e._type==t))),this[`__${t}_tag_cache`]}*get_TAG_iter(t,e,a){for(const r of a)if(t.getAttribute(`bx-${r._name}`)){const a=r({el:t,context:e,BX:this});this.tag_instances.push(a),yield a}}get each_tags(){return this.get_filtered_TAGS(t.each)}get block_tags(){return this.get_filtered_TAGS(t.block)}get helper_tags(){return this.get_filtered_TAGS(t.helper)}get_each_tags(t,e){return this.get_TAG_iter(t,e,this.each_tags)}get_block_tags(t,e){return this.get_TAG_iter(t,e,this.block_tags)}get_helper_tags(t,e){return this.get_TAG_iter(t,e,this.helper_tags)}main_loop(t){this.main_elements.forEach((e=>this.top_loop(e,t,p)))}top_loop(t,e,a){let r=this.do_helpers(t,e);if(!r.break_loop)return a(t,e=r.context,this.loop,this),t}loop(t,e,a){let r=this.do_blocks(e,a);if(!r.break_loop){let t=r.context,a=this.do_each(e,t);this.top_loop(e,t,a.each_method||p)}return e}do_each(t,e){let a=this.get_each_tags(t,e).next().value;return a?a.use():{break_loop:!1,context:e}}do_blocks(t,e){let a=!1,r=this.get_block_tags(t,e);for(const t of r){let r=t.use();if(r.break_loop){a=!0;break}e=r.context}return{break_loop:a,context:e}}do_helpers(t,e){let a=!1,r=this.get_helper_tags(t,e);for(const t of r){let r=t.use();if(r.break_loop){a=!0;break}e=r.context}return{break_loop:a,context:e}}render(t){this.main_loop(t)}clean(){this.tag_instances.reverse().forEach((t=>t.clean())),this.tag_instances=[]}}})();